<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analysis of Client-Side Encryption Reverse Engineering — thevillagehacker</title>
  <meta name="description" content="Analysis of Client-Side Encryption Reverse Engineering"/>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Bebas+Neue&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../assets/css/style.css"/>
</head>
<body>
<div class="page">

  <!-- Navigation -->
  <nav>
    <a class="nav-logo" href="../index.html">thevillagehacker</a>
    <ul class="nav-links">
      <li><a href="../blog.html">Blog</a></li>
      <li><a href="../about.html">Whoami</a></li>
      <li><a href="../changelog.html">Changelog</a></li>
    </ul>
  </nav>

  <!-- Post Header -->
  <div class="post-header">
    <div class="breadcrumb">
      <a href="../blog.html">Blog</a><span>→</span>Analysis of Client-Side Encryption Reverse Engineering
    </div>
    <h1 class="post-title">Analysis of Client-Side Encryption Reverse Engineering</h1>
    <div class="post-meta">
      <span>2023-02-18</span>
      <span>Naveen Jagadeesan</span>
      <span>thevillagehacker</span>
    </div>
  </div>

  <!-- Article Body -->
  <article>
<p>An in-depth analysis of reverse engineering client-side encryption in a web application.</p>
<h2>Target Background</h2>
<p>The target is a web application accessible through both web browsers and mobile applications on Android and iOS platforms. The application utilizes a centralized CDN (Content Delivery Network) system, indicating that there are multiple applications with similar features and shared resources. Through subdomain enumeration, it was discovered that the target has more than 15 applications sharing the same technology and all served by Amazon CDN.</p>
<h2>Overview</h2>
<p>Reconnaissance is a crucial step in identifying vulnerabilities in wide-ranging targets. During the recon phase, an interesting scenario was encountered where the application had been developed to encrypt all communication. The application employs a REST API service, and the host value in the REST API calls differs from the actual application URL. The request and response data bodies are encoded to ensure secure communication. However, due to the developer's decision to hardcode encryption keys and initialization vectors (IVs) in the client-side code, the application's security is compromised, despite being coded to provide an encrypted connection.</p>
<h2>Recon</h2>
<p>The following elements were investigated during the reconnaissance phase:</p>
<ul>
<li>Technology stack: ReactJS</li>
<li>CDN: Amazon CDN</li>
<li>API service: REST API</li>
<li>REST API host differs from the actual application URL</li>
<li>Sources loaded in the debugger/sources tab of the browser's development tools were examined</li>
<li>REST API communications, authorization mechanism, and encryption were analyzed</li>
</ul>
<h2>Analyzing Loaded Sources</h2>
<p>Considering the wide scope of the target and the shared CDN system, it was decided to examine the JavaScript (JS) files, excluding the chunk files generated by frameworks.</p>
<h2>Files Discovered</h2>
<p>The following JS files were identified:</p>
<ul>
<li>booking.js</li>
<li>desktop.js</li>
<li>home.js</li>
<li>search.js</li>
<li>signin.js</li>
<li>signup.js</li>
<li>main.js</li>
</ul>
<p>An in-depth analysis of all JS files was performed to identify keywords such as &quot;enc,&quot; &quot;encrypt,&quot; &quot;key,&quot; &quot;IV,&quot; &quot;initialization,&quot; and &quot;vector.&quot; However, no significant findings were obtained from these files. However, further investigation of the <strong>main.js</strong> file revealed valuable information.</p>
<pre><code class="language-js">91622: function (e, t) {
      'use strict';
      t.Z = {
        apiDomain: 'https://api.abc.com',
        adminDomain: 'https://admin.abc.com',
        searchApiDomain: 'https://search.abc.com',
        searchApiDomain: 'https://search.abc.com',
        preprodApiDomain: 'https://preprod.abc.com',
        bookingApiDomain: 'https://bookings.abc.com',
        blogsApiDomain: 'https://secure.abc.com',
        analyticsDomain: 'https://analytics.abc.com',
        cdnPath: 'https://cdn.abc.com',       
        s3accessKeyId: 'test-############',
        s3secretKey: 'test-############',
        s3Region: 'west',
        dataHasKey: '###################=',
        dataIVKey: 'jm8lgqa3j1d0ajus',
        zendesk: '###########################',
        giftCardUrl: 'https://join.abc.com/gift-card/',
        ASSET_CDN_PATH: 'https://assets.abc.com',
        consoleEnv: 'production',
        recaptchaV2Key: '###################-kAQFKNGH-',
        SHOPBACK_URL_DYNAMIC: 'https://shopback.abc.org/aff_l',
        SHOPBACK_MERCHANT_ID: '#########',
        encryptionKeys: '[&quot;##_analytics_detail||VWlRMVRtTnllWEJVSVRCdUo=&quot;,&quot;club_membership_detail||RFZEVW1WMEtFQlJKSDA9&quot;]'
      }
    }
</code></pre>
<p>A detailed analysis of the code revealed that the application also loads resources from another CDN. The <strong>main.js</strong> file contained the initialization vector (IV) referred to as <code>dataIVKey</code> in the code.</p>
<p>To investigate the encryption used in REST API calls, the application was loaded in the browser.</p>
<p><img src="../assets/images/blogs/RE/reqandresp.png" alt="img" /></p>
<p>The JS source files on the CDN subdomain <code>cdnPath: 'https://cdn.abc.com'</code> were inspected. While there were numerous files present, one file stood out: <em><strong>app.js</strong></em>. This file contained the necessary details for further exploitation.</p>
<pre><code class="language-js">abc.factory('SiteSettingService', [
  '$cookies',
  '$http',
  '$q',
  'SiteSettings',
  '$rootScope',
  'UrlFormatter',
  'LocalStorage',
  '$location',
  'MessageModal',
  'blockUI',
  'EncryptDecrypt',
  'SearchConditions'
  ]
</code></pre>
<p>The JS file contained functions for encrypting and decrypting the API body in HTTP requests and responses. The keyword &quot;encrypt&quot; led to the discovery of the encryption and decryption function code shown below:</p>
<pre><code class="language-js">abc.factory('EncryptDecrypt', [
  'AppSettings',
  function () {
    return {
      encryptKEY: 'UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0=',
      setkey: function (t) {
        this.encryptKEY = t
      },
      encrypt: function (t) {
        var e = this.encryptKEY,
        n = 'jm8lgqa3j1d0ajus',
        r = JSON.stringify(t);
        return CryptoJS.AES.encrypt(r, CryptoJS.enc.Utf8.parse(e), {
          iv: CryptoJS.enc.Utf8.parse(n),
          padding: CryptoJS.pad.Pkcs7,
          mode: CryptoJS.mode.CBC
        }).toString() + '---' + window.btoa(n)
      },
      decrypt: function (t) {
        var e = t.split('---'),
        n = browserCrypto.Buffer.from(e[1], 'base64'),
        r = browserCrypto.Buffer.from(e[0], 'base64'),
        a = browserCrypto.Buffer.from(this.encryptKEY),
        o = browserCrypto.createDecipheriv('aes256', a, n),
        i = o._update(r),
        s = o.final(),
        l = (i = browserCrypto.Buffer.concat([i,
        s])).toString();
        return JSON.parse(l)
      }
    }
  }
])
</code></pre>
<p>By reading the above code we clearly have an idea of what are the tools are required to break down this API encryption wall.</p>
<h2>Handy tools to break the wall</h2>
<ul>
<li>Encryption key = UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0=</li>
<li>IV = jm8lgqa3j1d0ajus</li>
<li>Encryption Mode = CBC</li>
<li>Encryption Algorithm = AES</li>
</ul>
<h2>Let's break</h2>
<p>I used the online AES decryption application you can find it <a href="https://www.devglan.com/online-tools/aes-encryption-decryption">here</a>.
Before start decrypting the json body let's go through the code first. The below line in the code shows that the final payload is created by adding the encrypted payload and <code>---</code> dashes and then follwed by the base64 encoded IV.</p>
<pre><code class="language-js">return CryptoJS.AES.encrypt(r, CryptoJS.enc.Utf8.parse(e), {
          iv: CryptoJS.enc.Utf8.parse(n),
          padding: CryptoJS.pad.Pkcs7,
          mode: CryptoJS.mode.CBC
        }).toString() + '---' + window.btoa(n)        
</code></pre>
<p><em><strong>btoa()</strong></em> method is used for encoding a string in base-64 format, so the IV will be encoded in base64 format.</p>
<p>Let's break down the final payload  the API is sending to the server.</p>
<pre><code class="language-json">{
  &quot;data&quot;: &quot;Ht2YM+y/yp4cn11iaWs/PmqQlSuLgrxMZwrQKnAt+qwRBYL2gt3uCHtPWC4soU1j0861mHg4Ij2jSJ0sq5R4iQK0lJ25hRjDf8OqwpNG97jv5jcCSNSFyYhjLqZYRGeFTLcxM7p4Jj9dl54LcXYWCPgAinKdQiPx/y9NC1g02g06HtCLFNFZlrTtJXPoFA70vkuT3VF84pHS+0yX3tVS0d0+b0AYlrePSuF8qxfnGGCcnhcbD/tCqesu3gFp3VCvZUaAnc9SzQlpF04a/D3R+izDG97FHEIFDsULmX0YOW5tEoUcsWRbDTfuswChDmrpNx6wMK8VR5+oSMF5r/y8eWEak0Xiaa9vc8J/TIt+j26pvDIgHRzCwfe7E9NpbBgiTt9OqoyZEyL61PRZ5UybCqqfj659WBKbF3B6ThQNQWw56CJDUTGp3sK59izgl4Bn3P76MvlpDC7rg4JTmprlk1BqxvMjmG/vqZn6IXUDR+TNHr+6zCfSTDkbeYKojs663BvddsrJIuhzgFryHe3DUZFnOahR1ViDanCahRZFkK97mfxUwHfAfJqkWkkpEhpAEV1ZUiBUpohmCWIYxjxtOBo9M9oiAxcAHZW9rbVu1X1KyadnRnO/i4JU40e8EmwsokGoufbi5Z5wOgK9sEO9LFTDH5LnF+UwXBM25oI3UFmwWrrYljNPdexm4iksslRUZGx1FQa1BlHQ8hGH+ch+ZOFu/AI8wfWx0v6lUiAx8ZTpmb+JQDb90S38rMIuh08frCixM9uyNiP1ue/W6lPW4GThtLSXcT+Ua+d4xrIHaEXP4mNNSUIQwUSo2m7kq3OoxNpbvjd3EtM9EkyJEIXcI0nn7cXuTfRpmJNMzJ0mrx6wMgJkPGJVrttNfhP4/FUXj/RrG4KYt+bpHrd7vExXNYYQCHRCKjRUzvr1ON99wBkaSHzvKHz9x/i0IMQ9kNBNB3Bge9mTsHaYs3nFqQOXS+HkASZkmc0jF+dK33X2fv8tBfJvQF4FL2AFPKyvPId3cq+RWLmvWde9h19ewuLBX/0adpiDea7HgnnIH3NewQhcrCZvfWodqtmhPKowtwk1---am04bGdxYTNqMWQwYWp1cw==&quot;
}
</code></pre>
<p>In the last line in the final payload there are 3 <code>---</code> dashes and followed by base64 encoded string which is the dataIV.</p>
<p>Alright! let decrypt the request payload and let's see how can we create an actual impact.</p>
<h2>Decrypting the request data</h2>
<pre><code class="language-json">{
    &quot;textToEncrypt&quot;: null,
    &quot;textToDecrypt&quot;: &quot;Ht2YM+y/yp4cn11iaWs/PmqQlSuLgrxMZwrQKnAt+qwRBYL2gt3uCHtPWC4soU1j0861mHg4Ij2jSJ0sq5R4iQK0lJ25hRjDf8OqwpNG97jv5jcCSNSFyYhjLqZYRGeFTLcxM7p4Jj9dl54LcXYWCPgAinKdQiPx/y9NC1g02g06HtCLFNFZlrTtJXPoFA70vkuT3VF84pHS+0yX3tVS0d0+b0AYlrePSuF8qxfnGGCcnhcbD/tCqesu3gFp3VCvZUaAnc9SzQlpF04a/D3R+izDG97FHEIFDsULmX0YOW5tEoUcsWRbDTfuswChDmrpNx6wMK8VR5+oSMF5r/y8eWEak0Xiaa9vc8J/TIt+j26pvDIgHRzCwfe7E9NpbBgiTt9OqoyZEyL61PRZ5UybCqqfj659WBKbF3B6ThQNQWw56CJDUTGp3sK59izgl4Bn3P76MvlpDC7rg4JTmprlk1BqxvMjmG/vqZn6IXUDR+TNHr+6zCfSTDkbeYKojs663BvddsrJIuhzgFryHe3DUZFnOahR1ViDanCahRZFkK97mfxUwHfAfJqkWkkpEhpAEV1ZUiBUpohmCWIYxjxtOBo9M9oiAxcAHZW9rbVu1X1KyadnRnO/i4JU40e8EmwsokGoufbi5Z5wOgK9sEO9LFTDH5LnF+UwXBM25oI3UFmwWrrYljNPdexm4iksslRUZGx1FQa1BlHQ8hGH+ch+ZOFu/AI8wfWx0v6lUiAx8ZTpmb+JQDb90S38rMIuh08frCixM9uyNiP1ue/W6lPW4GThtLSXcT+Ua+d4xrIHaEXP4mNNSUIQwUSo2m7kq3OoxNpbvjd3EtM9EkyJEIXcI0nn7cXuTfRpmJNMzJ0mrx6wMgJkPGJVrttNfhP4/FUXj/RrG4KYt+bpHrd7vExXNYYQCHRCKjRUzvr1ON99wBkaSHzvKHz9x/i0IMQ9kNBNB3Bge9mTsHaYs3nFqQOXS+HkASZkmc0jF+dK33X2fv8tBfJvQF4FL2AFPKyvPId3cq+RWLmvWde9h19ewuLBX/0adpiDea7HgnnIH3NewQhcrCZvfWodqtmhPKowtwk1&quot;,
    &quot;secretKey&quot;: &quot;UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0=&quot;,
    &quot;mode&quot;: &quot;CBC&quot;,
    &quot;keySize&quot;: 256,
    &quot;output&quot;: &quot;eyJmaXJzdF9uYW1lIjoidGVzdCIsImxhc3RfbmFtZSI6InVzZXIiLCJlbWFpbCI6Im5qQHR2aHNlYy5jb20iLCJwaG9uZSI6IjkxODc5NDU2MzIxNCIsInBhc3N3b3JkIjoiUGFzc0AxMjMiLCJjb25maXJtX3Bhc3N3b3JkIjoiUGFzc0AxMjMiLCJpc191bnN1YnNjcmliZWQiOnRydWUsImNhcHRjaGEiOiIwM0FGWV9hOFhONGNCUVFjMGRnQnNlYTRKc1NEdEpuYTFGb09yX1BWYlFOeGYwSnpLZEdLRXNyeWpfWXNKazlQQ05aaDhWNmV3R1dLam1xQkMyQzJ0NWNvSmR4OWFaZ00wUGRCbDRfMzQ1dTE0MlZrXzhDT2c4R3Z4dXRmRjJvQ1p6WGVUTVdnVmNXMlpnMzFMNWszd3VXVkVnSlFnQXJOZ1E0VUhwYW5BQ1lkeEZpTENRYl84SUpTMWdEbVNKY3pZZHRYZ1kybnNBOGQ3Sl9sd0xJNHJnb1Y1Z2IwVXAzWnJSUEZKTnduUk4tS3h0d0dtRGJpYjk2TF9ZbDF6Ym03TFZjSkJNRzZhbDJyMEw1dGt1eFdsdTV0RTZ4MTIzYWNFQ0lQUVJkMktKN2Fwc1owbkd3VF9GdFEtMnJCbjVRTDJtU0x5a0tlQ3ZsNFE1TUphZlR6OTV6ODNJcEs5QVZWUkwwRWl5dENVWjhSQ205NzRoOV9xTTVLa091RXoxQmU3THpMRDJFUzNpNjJQbHZvUGZ6UXlMV3RaUWNSSDRPTWhvcTlMMkduUXVTbE5SaHRqNGVycVRhdkV3eC1ZQklPNnpqeFdWWnBtTm5LWG1uREk0amZNa3FTUk1EaTVqdFFHeXYxQ0tMRVMyRHU0MTFkaGNYR3ZqVVhQSUh3SUlrTDhCdl9weWlENmJSTkdHdXJJSkhEWTZFdDlzUVBRbWJmU2JxQnYxNm1Fd0dxbEdmMWk4LThMbUQ1RSIsInZlcnNpb24iOiJ2MiIsInJlY3RWaWV3IjoidnVlIiwic291cmNlIjoiTG9naW5BY3Rpdml0eSJ9&quot;,
    &quot;dataFormat&quot;: &quot;Base64&quot;,
    &quot;iv&quot;: &quot;jm8lgqa3j1d0ajus&quot;
}
</code></pre>
<p>decode the base64 encoded output from the above</p>
<pre><code class="language-json">{
  &quot;first_name&quot;: &quot;test&quot;,
  &quot;last_name&quot;: &quot;user&quot;,
  &quot;email&quot;: &quot;nj@tvhsec.com&quot;,
  &quot;phone&quot;: &quot;918794563214&quot;,
  &quot;password&quot;: &quot;Pass@123&quot;,
  &quot;confirm_password&quot;: &quot;Pass@123&quot;,
  &quot;is_unsubscribed&quot;: true,
  &quot;captcha&quot;: &quot;03AFY_a8XN4cBQQc0dgBsea4JsSDtJna1FoOr_PVbQNxf0JzKdGKEsryj_YsJk9PCNZh8V6ewGWKjmqBC2C2t5coJdx9aZgM0PdBl4_345u142Vk_8COg8GvxutfF2oCZzXeTMWgVcW2Zg31L5k3wuWVEgJQgArNgQ4UHpanACYdxFiLCQb_8IJS1gDmSJczYdtXgY2nsA8d7J_lwLI4rgoV5gb0Up3ZrRPFJNwnRN-KxtwGmDbib96L_Yl1zbm7LVcJBMG6al2r0L5tkuxWlu5tE6x123acECIPQRd2KJ7apsZ0nGwT_FtQ-2rBn5QL2mSLykKeCvl4Q5MJafTz95z83IpK9AVVRL0EiytCUZ8RCm974h9_qM5KkOuEz1Be7LzLD2ES3i62PlvoPfzQyLWtZQcRH4OMhoq9L2GnQuSlNRhtj4erqTavEwx-YBIO6zjxWVZpmNnKXmnDI4jfMkqSRMDi5jtQGyv1CKLES2Du411dhcXGvjUXPIHwIIkL8Bv_pyiD6bRNGGurIJHDY6Et9sQPQmbfSbqBv16mEwGqlGf1i8-8LmD5E&quot;,
  &quot;version&quot;: &quot;v2&quot;,
  &quot;rectView&quot;: &quot;vue&quot;,
  &quot;source&quot;: &quot;LoginActivity&quot;
}
</code></pre>
<p>Now we have successfully decoded the JSON body and now we have to construct a fully working JSON payload to send it to the server, for that we have to contruct a payload as below in the js code.</p>
<pre><code class="language-js">return CryptoJS.AES.encrypt(r, CryptoJS.enc.Utf8.parse(e), {
          iv: CryptoJS.enc.Utf8.parse(n),
          padding: CryptoJS.pad.Pkcs7,
          mode: CryptoJS.mode.CBC
        }).toString() + '---' + window.btoa(n)
</code></pre>
<p>Valid request body = Encrypted payload + <code>---</code> + base64 encoded IV</p>
<h2>Encrypted Payload</h2>
<pre><code class="language-json">{
    &quot;textToEncrypt&quot;: &quot;{\n  \&quot;first_name\&quot;: \&quot;enc\&quot;,\n  \&quot;last_name\&quot;: \&quot;user\&quot;,\n  \&quot;email\&quot;: \&quot;nj+1@tvhsec.com\&quot;,\n  \&quot;phone\&quot;: \&quot;918794563214\&quot;,\n  \&quot;password\&quot;: \&quot;Pass@123\&quot;,\n  \&quot;confirm_password\&quot;: \&quot;Pass@123\&quot;,\n  \&quot;is_unsubscribed\&quot;: true,\n  \&quot;captcha\&quot;: \&quot;03AFY_a8XN4cBQQc0dgBsea4JsSDtJna1FoOr_PVbQNxf0JzKdGKEsryj_YsJk9PCNZh8V6ewGWKjmqBC2C2t5coJdx9aZgM0PdBl4_345u142Vk_8COg8GvxutfF2oCZzXeTMWgVcW2Zg31L5k3wuWVEgJQgArNgQ4UHpanACYdxFiLCQb_8IJS1gDmSJczYdtXgY2nsA8d7J_lwLI4rgoV5gb0Up3ZrRPFJNwnRN-KxtwGmDbib96L_Yl1zbm7LVcJBMG6al2r0L5tkuxWlu5tE6x123acECIPQRd2KJ7apsZ0nGwT_FtQ-2rBn5QL2mSLykKeCvl4Q5MJafTz95z83IpK9AVVRL0EiytCUZ8RCm974h9_qM5KkOuEz1Be7LzLD2ES3i62PlvoPfzQyLWtZQcRH4OMhoq9L2GnQuSlNRhtj4erqTavEwx-YBIO6zjxWVZpmNnKXmnDI4jfMkqSRMDi5jtQGyv1CKLES2Du411dhcXGvjUXPIHwIIkL8Bv_pyiD6bRNGGurIJHDY6Et9sQPQmbfSbqBv16mEwGqlGf1i8-8LmD5E\&quot;,\n  \&quot;version\&quot;: \&quot;v2\&quot;,\n  \&quot;rectView\&quot;: \&quot;vue\&quot;,\n  \&quot;source\&quot;: \&quot;LoginActivity\&quot;\n}&quot;,
    &quot;textToDecrypt&quot;: null,
    &quot;secretKey&quot;: &quot;UiQ1TmNyeXBUITBuJDVDUmV0KEBRJH0=&quot;,
    &quot;mode&quot;: &quot;CBC&quot;,
    &quot;keySize&quot;: 256,
    &quot;output&quot;: &quot;7LJE5P5kV3HvDdOdxWPQkQDbwqlTp2817vWfuCp/F3CzdTj9rWvrAlisK7/pRR0ff7g6Fd16im4Zrw1Zac5qHSbTRmV2cyvHgKcRwtonAGnU0toMYEuPkXdswUGKKgJRkZ0nQcYZVsPRX5D2gWoglp4kzFHZM8Y1dtVQLoYeqi3pc8vKI5FU5AeeTqZdAWWVEJcsZIlKY2o94fVzrXJ1XD/95aLXk3wbfDhJDP50jMfSM8TAl4Oa7mBbpMArnNU4XJscqfuXrXc5KyxvyPbmc/IwA7ndlhljJJ7zMjtnS9GzzkYjuWdISkLB1rH/pvXS7AUEj0UpIn2DBIsHayVYkBYHaRP6YZ8vVZGMoXVK1kS6w1W6JFUOzkfcTMWVbKAifJxxtlzt5cuJZa/iDHTMMrh/xAOqc04mdn73sBGAFMN5KlJx0lEe8XlKFkm3UcRdrzLj0/VmLHAN75dXX7iNs5ZvswYr8EcHG2fscIIoJ3mtySlDVgcR1fl8ZIcSXLVAzzazF8ZldJ9bzExMrFqUK73R9ZE5sEJIgoWqotlBIWUxC8WtfY8aLLcWiDHaPvoGtS5lnajJ0/zx5oHEFKdZaGDsGjOycGHeJbZgkDU5u3WhzrgTw8+FaNqluT+vDPHTlxpDPy/h1I7TL1YfpjLeUjSIEY2gYmD1Ew/ii5lBBPcqI7F3gWNh+t/wt7Y7xSmXJ92Z9X93iVAiM27yEnbreC8i5GQzU+OgqPogrEw8Lu0m86cpgGfXrv1bL2ihxW9fNKEWCexMx0U0cHdlqDVdoQ3PcyutXRvZH58F81Aw2jL0O6GC7/ijYN59gboFhoh7Fh0GWRlRkMA2gXnGgNZejFUE8qzTnusINmEeGwbmdIQ18w/WGKT0V5ZvCDbjVCIHK8fOx+64y0oJ4tN7a2/idP5Xlciz1qsitfuCB+7DBhIgSpOXbG+Pe6mW9lW31qlyljabDpk3SdX+X9z+9Hh7/7QooghpXePk+snSTtqHPxWlKI/np5cGcBmnB8kZXGOyyeBuLOciKdEdqJ8Luu6huLGNSo9ftaDgn9TMjcBw2c2MU6sClP31DYTlfake9iaFrXrdisi+YorPU4g+T8ojrVpDGWnnh1uHjc8KsTlsULU=&quot;,
    &quot;dataFormat&quot;: &quot;Base64&quot;,
    &quot;iv&quot;: &quot;jm8lgqa3j1d0ajus&quot;
}
</code></pre>
<h2>Newly constructed request</h2>
<p><img src="../assets/images/blogs/RE/reqandresp2.png" alt="img" /><br></p>
<p>Now it's time to exploit issues and create a huge impact. Based on the decrypted data as we can see, the application is using the CAPTCHA system to protect the application from the brute-forcing and spamming vulnerabilities. If we can find a way to bypass the CAPTCHA protection then we can convince the triager to show the real imapcts like high resource usage, spamming and by create user accounts with false data. The last part creating false accounts using false data is only applicable when the application does not have data verification system. As per the recon the application is not validating anything at all, so now we can show the impact.</p>
<p>Let's jump into find a way to bypass the CAPTCHA.</p>
<h2>CAPTCHA Recon</h2>
<p>The application is using google reCAPTCHA.</p>
<p><img src="../assets/images/blogs/RE/captcha.png" alt="img" /><br></p>
<p>I have observed there was a strange behaviour in the reCAPTCHA system which is everytime you click the checkbox it sends two requests such as 1 to get the CAPTCHA response and other is to verify the CAPTCHA response in the next upcoming request.</p>
<h2>Bypass</h2>
<p>We cannot send the same CAPTCHA response code more than once, if we do that the server will respond as below,</p>
<pre><code class="language-http">HTTP/1.1 200 OK 
Access-Control-Allow-Origin: * 
Content-Type: application/json; charset=utf-8 
Set-Cookie: blah...blah...blah...; Path=/; HttpOnly 
X-Frame-Options: SAMEORIGIN 
X-Content-Type-Options: nosniff 
X-XSS-Protection: 1; mode=block 
Referrer-Policy: strict-origin-when-cross-origin 
Connection: close 
Strict-Transport-Security: max-age=31536000; includeSubDomains

[&quot;uvresp&quot;,null,null,null,2]
</code></pre>
<p>From the below request what i have observed is you can send the below CAPTCHA request as long as we want and it will still provide us the response code to be verified in the upcoming verification request.</p>
<p><img src="../assets/images/blogs/RE/captcha1.png" alt="img" /></p>
<h2>Workflow</h2>
<p>Get CAPTCHA code -&gt; use it in next verfication request -&gt; will provide the final CAPTCHA code which is included in the JSON body</p>
<p>The final verification code can be obtained like the below,</p>
<p><img src="../assets/images/blogs/RE/captcha2.png" alt="img" /></p>
<p>So the entire flow will be automated by using a python script to get the final CAPTCHA code to be encrypted in the JSON body to create accounts/any other operations like brute-forcing usernames and passwords.</p>
<p>By chaining the client side code encryption reverse engineering and the misconfigured CAPTCHA mechanism will allow us to create false accounts, resource consumption, increased data tables in DB which will add more cost to the company's usage bill.</p>
<p>Thanks for reading!</p>
<p>For more updates and insights, follow me on Twitter: <a href="https://twitter.com/thevillagehackr">@thevillagehacker</a>.</p>

  </article>

  <!-- Post Navigation -->
  <div class="post-nav">
    <a href="2022-12-15-RCE-DLL-Hijacking.html" class="post-nav-link prev"><div class="post-nav-dir">← Previous</div><div class="post-nav-title">Remote Code Execution via DLL Hijacking on a Prominent Business Automation Application</div></a>
    <a href="2023-03-25-Hacking_MNCs-CMS_Systems.html" class="post-nav-link next"><div class="post-nav-dir">Next →</div><div class="post-nav-title">Exploiting Misconfigurations and Authorization Vulnerabilities in a Multinational Company's Content Management System</div></a>
  </div>

  <!-- Footer -->
  <footer>
    <span class="footer-text">
      © 2025 <a href="../index.html">thevillagehacker</a>
      — Naveen Jagadeesan
    </span>
    <span class="footer-text">
      status: active<span class="blink"></span>
    </span>
  </footer>

</div>
</body>
</html>