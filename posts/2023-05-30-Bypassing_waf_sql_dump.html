<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bypassing Web Application Firewall (WAF) to Exploit SQL Injection Vulnerabilities ‚Äî thevillagehacker</title>
  <meta name="description" content="Bypassing Web Application Firewall (WAF) to Exploit SQL Injection Vulnerabilities"/>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Bebas+Neue&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../assets/css/style.css"/>
</head>
<body>
<div class="page">

  <!-- Navigation -->
  <nav>
    <a class="nav-logo" href="../index.html">thevillagehacker</a>
    <ul class="nav-links">
      <li><a href="../blog.html">Blog</a></li>
      <li><a href="../about.html">Whoami</a></li>
      <li><a href="../changelog.html">Changelog</a></li>
    </ul>
  </nav>

  <!-- Post Header -->
  <div class="post-header">
    <div class="breadcrumb">
      <a href="../blog.html">Blog</a><span>‚Üí</span>Bypassing Web Application Firewall (WAF) to Exploit SQL Injection Vulnerabilities
    </div>
    <h1 class="post-title">Bypassing Web Application Firewall (WAF) to Exploit SQL Injection Vulnerabilities</h1>
    <div class="post-meta">
      <span>2023-05-30</span>
      <span>Naveen Jagadeesan</span>
      <span>thevillagehacker</span>
    </div>
  </div>

  <!-- Article Body -->
  <article>
<p>This blog delves into the techniques used to bypass a Web Application Firewall (WAF) and exploit SQL injection vulnerabilities in a financial management web application.</p>
<h2>Target Background</h2>
<p>The target of this analysis is a web application developed for financial management purposes. It offers a range of features, including bulk payment management, invoicing, and sending promotional messages to customers regarding card offers.</p>
<h2>Overview</h2>
<p>The application incorporates input validation for its fields and employs a web application firewall (WAF) to detect and reject requests containing malicious payloads. However, due to a rookie misconfiguration, manually checking each button in the application could potentially reveal a bypass for the firewall.</p>
<h2>Reconnaissance</h2>
<ul>
<li>The application is built using ReactJS.</li>
<li>It is hosted on a non-cloud environment.</li>
<li>It might be running on IIS.</li>
</ul>
<h2>Crawl and Audit ü™≤</h2>
<p>I created an account and thoroughly tested all the features, but couldn't find any vulnerabilities. To dig deeper, I utilized a custom tool I developed to identify embedded locations and URLs within the application. By enumerating all the pages and analyzing the embedded locations, I hoped to discover potential vulnerabilities, particularly SQL and cross-site scripting (XSS) injection points.</p>
<h2>SQL Injection üíâ</h2>
<p>After scrutinizing hundreds of requests and thousands of input fields, I identified a suspicious parameter named <strong>request_module</strong>. This parameter appears to be generated by the application's underlying framework, although I couldn't determine which framework it is. Using an automated tool called <strong>sqmap</strong>, I detected a potential Boolean-based SQL injection vulnerability.</p>
<h2>WAFüõ°Ô∏è</h2>
<p>Since the application employs a web application firewall, all of my injection payloads were rejected with a 400 Bad Request response. After a while, my IP address was blocked for 15 minutes.</p>
<p>Feeling discouraged, I decided to examine the requests further. I discovered that in one endpoint, the application sends a POST request to a page where users can create HTML content to be published to their customers.</p>
<h3>Request</h3>
<pre><code class="language-http">POST /api/v1/promo_offers HTTP/2
Host: www.target.com
Cookie: blah...blah...blah...
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://www.target.com/
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: iframe
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: cross-site
Te: trailers

{
  &quot;Title&quot;: &quot;Promo1&quot;,
  &quot;Content&quot;: &quot;&lt;h2&gt;This is a wonderful offer&lt;/h2&gt;&lt;p&gt;Hurry up to get the best deals out of it...&lt;/p&gt;&quot;
}
</code></pre>
<p>In the above request, the application publishes HTML content. The input validation for this page allows only whitelisted HTML tags and content.</p>
<p>While reviewing the requests again, I came across an internal request that was likely meant for testing purposes but was unintentionally left in the production code.</p>
<h3>Internal Request</h3>
<pre><code class="language-http">POST /internal/api/v1/promo_offers HTTP/2
Host: www.target.com
X-Forwarded-For: localhost:4563
Cookie: blah...blah...blah...
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://www.target.com/
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: iframe
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: cross-site
Te: trailers

{
  &quot;Title&quot;: &quot;Promo1&quot;,
  &quot;Content&quot;: &quot;&lt;h2&gt;This is a wonderful offer&lt;/h2&gt;&lt;p&gt;Hurry up to get the best deals out of it...&lt;/p&gt;&quot;
}
</code></pre>
<p>The API endpoint directory location begins with <strong>internal</strong>, and it shares the same POST request as before, with the addition of the <strong>X-Forwarded-For: localhost:4563</strong> header.</p>
<p>When I sent the request, it responded with a <strong>200 OK</strong> response. Consequently, I modified the payload from HTML to various SQL injection payloads, but the response remained 200 OK, suggesting no exploitable vulnerabilities.</p>
<h2>Bypass üíâ</h2>
<p>Considering the suspicious nature of the <strong>request_module</strong> parameter, I configured the <strong>X-Forwarded-For: localhost:4563</strong> header in the request containing the <strong>request_module</strong> parameter. I then automated this request using <strong>sqlmap</strong>.</p>
<h2>Automated Process using Sqlmap</h2>
<p><img src="../assets/images/blogs/sqli2/1.png" alt="img" /></p>
<h2>Confirming Vulnerability</h2>
<p>By increasing the risk level to 3 and 4, sqlmap identified that the <strong>request_module</strong> parameter is vulnerable to a Boolean-based SQL injection attack.</p>
<p><img src="../assets/images/blogs/sqli2/2.png" alt="img" /></p>
<h2>Enumerating the Database</h2>
<p><img src="../assets/images/blogs/sqli2/3.png" alt="img" /></p>
<h2>Available Databases</h2>
<p><img src="../assets/images/blogs/sqli2/4.png" alt="img" /></p>
<p>The scanning process took approximately an hour, during which all the databases were enumerated. I then proceeded to dump the entire database.</p>
<p><strong>Note:</strong> <em>To expedite the table enumeration process, increase the number of threads.</em></p>
<p>Thank you for reading!</p>
<p>For more updates and insights, follow me on Twitter: <a href="https://twitter.com/thevillagehackr">@thevillagehacker</a>.</p>

  </article>

  <!-- Post Navigation -->
  <div class="post-nav">
    <a href="2023-04-12-Business_logic_error.html" class="post-nav-link prev"><div class="post-nav-dir">‚Üê Previous</div><div class="post-nav-title">Exploiting Business Logic Error: Price Manipulation</div></a>
    <a href="2023-07-13-Database_Dump_Exploitation_through_Mass_Assignment_Vulnerability.html" class="post-nav-link next"><div class="post-nav-dir">Next ‚Üí</div><div class="post-nav-title">Unveiling the Consequences: Database Dump Exploitation through Mass Assignment Vulnerability</div></a>
  </div>

  <!-- Footer -->
  <footer>
    <span class="footer-text">
      ¬© 2025 <a href="../index.html">thevillagehacker</a>
      ‚Äî Naveen Jagadeesan
    </span>
    <span class="footer-text">
      status: active<span class="blink"></span>
    </span>
  </footer>

</div>
</body>
</html>